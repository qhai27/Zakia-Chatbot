<!DOCTYPE html>
<html lang="ms">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZAKIA Chatbot - LZNK</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="zakat-styles.css" />
  <link rel="stylesheet" href="reminder-styles.css" />
  <script src="js/config.js"></script>
  <script src="js/reminder-handler.js"></script>
  <script src="js/zakat-handler.js"></script>
  <script src="js/chatbot.js"></script>
</head>

<body>
  <div class="chatbox" role="region" aria-label="ZAKIA Chatbot">
    <div class="header">
      <div class="header-left">
        <img src="zakia-avatar.png" class="avatar" alt="ZAKIA">
        <div class="header-text">
          <h3>ZAKIA</h3>
          <p>LZNK Chat Support</p>
        </div>
      </div>
      <button class="minimize-btn" title="Minimize">âˆ’</button>
    </div>

    <div class="end-chat-section">
      <button id="endChat" class="btn-end" title="End Chat">End Chat</button>
    </div>

    <div class="chat-container">
      <div class="date-indicator">
        <span id="dateChip" class="date-chip"></span>
      </div>

      <div id="messages" class="messages" aria-live="polite" aria-relevant="additions">
        <div class="msg bot">
          <img src="zakia-avatar.png" class="msg-avatar" alt="ZAKIA">
          <div class="bubble bot-bubble">
            <p>Assalamualaikum dan salam sejahtera! ðŸ‘‹ Saya Zakia, pembantu maya dari Lembaga Zakat Negeri Kedah (LZNK).</p>
            <p>Saya boleh membantu anda dengan:</p>
            <p>- Soalan tentang zakat
            <br>-  Kalkulator zakat
            <br>-  Maklumat tentang zakat dan nisab</p>
            <p>Bagaimana saya boleh membantu anda hari ini?ðŸ˜Š </p>
          </div>
        </div>
      </div>

      <div id="typing" class="typing hidden">
        <img src="zakia-avatar.png" class="msg-avatar" alt="ZAKIA">
        <div class="typing-bubble">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
      </div>

      <div id="quickReplies" class="quick-replies">
        <button class="quick-reply" data-text="Apa itu zakat?">Apa itu zakat?</button>
        <button class="quick-reply" data-text="Siapa yang wajib bayar zakat?">Siapa yang wajib bayar zakat?</button>
        <button class="quick-reply" data-text="Kira zakat">ðŸ’° Kira Zakat</button>
        <button class="quick-reply" data-text="Nisab">ðŸ“Š Maklumat Nisab</button>
      </div>
    </div>

    <div class="input-area">
      <textarea id="userInput" rows="1" placeholder="Tulis mesej andaâ€¦ (Contoh: 'kira zakat pendapatan')" autocomplete="off"></textarea>
      <button id="sendBtn" class="btn-send" aria-label="Hantar" title="Hantar">
        <img src="buttonsend.png" alt="Hantar" class="send-icon">
      </button>
    </div>
  </div>

  <!-- Load scripts -->
  <script src="js/zakat-handler.js"></script>
  <script src="js/chatbot.js"></script>

  <script>
    (function(){
      const ta = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');
      const messagesEl = document.getElementById('messages');

      if (!ta) return;

      function resize() {
        ta.style.height = 'auto';
        const target = Math.min(ta.scrollHeight, 220);
        ta.style.height = target + 'px';

        if (messagesEl) {
          messagesEl.scrollTop = messagesEl.scrollHeight;
        }
      }

      resize();

      ta.addEventListener('input', resize);
      ta.addEventListener('paste', () => setTimeout(resize, 50));
      ta.addEventListener('change', resize);

      ta.addEventListener('keydown', function(e){
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendBtn.click();

          setTimeout(() => {
            if (ta.value.trim() === '') {
              ta.style.height = '40px';
            } else {
              ta.value = '';
              ta.style.height = '40px';
            }
            resize();
            if (messagesEl) messagesEl.scrollTop = messagesEl.scrollHeight;
          }, 150);
        }
      });

      sendBtn.addEventListener('click', () => {
        setTimeout(() => {
          if (ta.value.trim() === '') {
            ta.style.height = '40px';
          } else {
            resize();
          }
          if (messagesEl) messagesEl.scrollTop = messagesEl.scrollHeight;
        }, 150);
      });

      window.addEventListener('resize', resize);
    })();

    // Populate date chip
    (function(){
      const el = document.getElementById('dateChip');
      if (!el) return;
      const now = new Date();
      const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      let text = now.toLocaleDateString('ms-MY', opts);
      text = text.charAt(0).toUpperCase() + text.slice(1);
      el.textContent = text;
    })();
  </script>
</body>

</html>