<!DOCTYPE html>
<html lang="ms">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZAKIA Chatbot - LZNK</title>
  <link rel="stylesheet" href="style.css" />
  <script src="js/config.js"></script>

  
 
</head>

<body>
  <div class="chatbox" role="region" aria-label="ZAKIA Chatbot">
    <div class="header">
      <div class="header-left">
        <img src="zakia-avatar.png" class="avatar" alt="ZAKIA">
        <div class="header-text">
          <h3>ZAKIA</h3>
          <p>LZNK Chat Support</p>
        </div>
      </div>
      <button class="minimize-btn" title="Minimize">âˆ’</button>
    </div>

    <div class="end-chat-section">
      <button id="endChat" class="btn-end" title="End Chat">End Chat</button>
    </div>

    <div class="chat-container">
      <div class="date-indicator">
        <span id="dateChip" class="date-chip"></span>
      </div>

      <div id="messages" class="messages" aria-live="polite" aria-relevant="additions">
        <div class="msg bot">
          <img src="zakia-avatar.png" class="msg-avatar" alt="ZAKIA">
          <div class="bubble bot-bubble">
            <p>Assalamualaikum dan salam sejahtera! ðŸ‘‹ Saya Zakia, pembantu maya dari Lembaga Zakat Negeri Kedah (LZNK). Bagaimana saya boleh membantu anda hari ini? ðŸ˜Š
          </div>
        </div>
      </div>

      <div id="typing" class="typing hidden">
        <img src="zakia-avatar.png" class="msg-avatar" alt="ZAKIA">
        <div class="typing-bubble">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
      </div>

      <div id="quickReplies" class="quick-replies">
        <button class="quick-reply" data-text="Apa itu zakat?">Apa itu zakat?</button>
        <button class="quick-reply" data-text="Siapa yang wajib bayar zakat?">Siapa yang wajib bayar zakat?</button>
        <button class="quick-reply" data-text="Cara pembayaran zakat">Cara pembayaran zakat</button>
        <button class="quick-reply" data-text="Jenis zakat ada berapa?">Jenis zakat ada berapa?</button>
      </div>
    </div>

    <div class="input-area">
      <!-- Use a textarea so it grows with content -->
      <textarea id="userInput" rows="1" placeholder="Tulis mesej andaâ€¦" autocomplete="off"></textarea>
      <button id="sendBtn" class="btn-send" aria-label="Hantar" title="Hantar">âœˆ</button>
    </div>
  </div>

  <script src="js/chatbot.js"></script>

  <!-- Improved auto-resize behaviour: keeps messages scrolled and prevents jumping -->
  <script>
    (function(){
      const ta = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');
      const messagesEl = document.getElementById('messages');

      if (!ta) return;

      function resize() {
        // temporarily reset height to measure scrollHeight correctly
        ta.style.height = 'auto';
        const target = Math.min(ta.scrollHeight, 220); // same limit as CSS
        ta.style.height = target + 'px';

        // keep messages scrolled to bottom while typing
        if (messagesEl) {
          messagesEl.scrollTop = messagesEl.scrollHeight;
        }
      }

      // Initial resize
      resize();

      // Resize on input and on paste
      ta.addEventListener('input', resize);
      ta.addEventListener('paste', () => setTimeout(resize, 50));
      ta.addEventListener('change', resize);

      // Press Enter to send (Shift+Enter for newline)
      ta.addEventListener('keydown', function(e){
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          // Trigger existing send handler (chatbot.js should read #userInput value)
          sendBtn.click();

          // Clear textarea after a short delay to allow send logic to read value
          setTimeout(() => {
            // Only clear if value hasn't changed (avoid clearing if chatbot.js didn't send)
            if (ta.value.trim() === '') {
              ta.style.height = '40px';
            } else {
              ta.value = '';
              ta.style.height = '40px';
            }
            resize();
            if (messagesEl) messagesEl.scrollTop = messagesEl.scrollHeight;
          }, 150);
        }
      });

      // When send button used (mouse), clear + resize after send
      sendBtn.addEventListener('click', () => {
        setTimeout(() => {
          if (ta.value.trim() === '') {
            ta.style.height = '40px';
          } else {
            // keep current height if user still has text (chatbot.js may not clear)
            resize();
          }
          if (messagesEl) messagesEl.scrollTop = messagesEl.scrollHeight;
        }, 150);
      });

      // ensure resize on window resize (keeps layout stable)
      window.addEventListener('resize', resize);
    })();

    // ...added code: populate real date in the date chip...
    (function(){
      const el = document.getElementById('dateChip');
      if (!el) return;
      const now = new Date();
      const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      // Use Malay locale to get localized month names (e.g. "26 Oktober 2025")
      let text = now.toLocaleDateString('ms-MY', opts);
      // Capitalize first letter for consistency
      text = text.charAt(0).toUpperCase() + text.slice(1);
      el.textContent = text;
    })();
  </script>
</body>

</html>